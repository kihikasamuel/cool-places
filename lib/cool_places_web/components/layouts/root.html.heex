<!DOCTYPE html>
<html lang="en" class="light scroll-smooth [scrollbar-gutter:stable]" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="csrf-token" content={get_csrf_token()} />
    <.live_title default="CoolPlaces" suffix=" Â· Travel Planner">
      {assigns[:page_title]}
    </.live_title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta content="Tour & Travels" name="description" />
    <meta
      content="Tour, Travels, agency, business, corporate, tour packages, journey, trip, tailwind css, Admin, Landing"
      name="keywords"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" href={~s"/images/favicon.ico"} />

    <link phx-track-static rel="stylesheet" href={~p"/assets/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/app.js"}></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
    <!-- Main Css -->
    <%!-- <link
      href={~p"/assets/libs/@mdi/font/css/materialdesignicons.min.css"}
      rel="stylesheet"
      type="text/css"
    /> --%>
  </head>
  <body class="bg-gray-50 font-sans text-gray-800">
    <!-- Loader Start -->
        <!-- <div id="preloader">
            <div id="status">
                <div class="spinner">
                    <div class="double-bounce1"></div>
                    <div class="double-bounce2"></div>
                </div>
            </div>
        </div> -->
    <!-- Loader End -->        
    <!-- Start -->

    {@inner_content}
    
  <!-- Itinerary Modal (LLM-Powered) -->
    <transition x-data="{open: false}" name="modal-fade">
      <div
        x-show="open"
        class="fixed inset-0 z-[100] flex items-center justify-center p-4"
        style="background-color: rgba(0, 0, 0, 0.7);"
        @click="open = !open"
      >
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden transform transition-all duration-300 scale-95 opacity-0" x-bind:class="{'scale-100 opacity-100': open}">
          <div class="p-6 sm:p-8 flex flex-col h-full">
            <div class="flex justify-between items-start mb-6 border-b pb-4">
              <h3 class="text-2xl sm:text-3xl font-extrabold text-primary-blue leading-tight">
                <i
                  data-lucide="plane"
                  class="w-6 h-6 sm:w-7 sm:h-7 inline-block mr-2 align-top text-secondary-green"
                >
                </i>
                3-Day Itinerary for
                <span class="text-gray-900">
                  <%!-- {currentDestinationName} --%>
                </span>
              </h3>
              <button
                @click="isModalOpen = false"
                class="text-gray-400 hover:text-gray-700 transition p-1"
              >
                <i data-lucide="x" class="w-6 h-6"></i>
              </button>
            </div>
            
      <!-- Content Area -->
            <div class="flex-grow overflow-y-auto pr-2">
              <div v-if="isLoading" class="text-center py-10">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4 mx-auto">
                </div>
                <p class="text-lg font-medium text-gray-600">
                  Generating personalized itinerary...
                </p>
                <p class="text-sm text-gray-500 mt-1">
                  Powered by Gemini AI and real-time Google Search grounding.
                </p>
              </div>

              <div v-else>
                <div v-if="itineraryText" class="prose max-w-none text-gray-700">
                  <!-- Displaying Markdown content -->
                  <div v-html="renderMarkdown(itineraryText)" class="markdown-output"></div>
                </div>
                <p v-else class="text-red-500 text-center py-10">
                  An error occurred while generating the itinerary. Please check the console for details.
                </p>
                
      <!-- Sources -->
                <div
                  v-if="itinerarySources.length > 0 && !isLoading"
                  class="mt-8 pt-4 border-t border-gray-100"
                >
                  <h4 class="text-sm font-semibold text-gray-500 mb-2">
                    Sources (Grounded by Google Search):
                  </h4>
                  <ul class="text-xs space-y-1">
                    <%!-- v-for="(source, index) in itinerarySources" --%>
                    <li class="text-gray-500 hover:text-primary-blue">
                      <a href="source.uri" target="_blank" class="truncate block">
                        <%!-- {source.title} --%>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </transition>
  </body>
</html>
